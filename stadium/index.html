<!DOCTYPE html>
<html>
  <head>
    <title>SSO</title>
  </head>
  <body>
    <h1>Welcome to Stadium!</h1>
    <h2>Session: <span id="sessionData"></span></h2>
    <script type="text/javascript">
      document.cookie = "authenticated=true";
      localStorage.setItem('authenticated', true)

      function refreshData(event) {
        var data = {
          cookie: document.cookie != "",
          session: localStorage.getItem('session'),
          localStorage: localStorage.getItem('authenticated')
        }
        event.source.postMessage(data, event.origin)
      }

      function refreshSession() {
        var span = document.getElementById("sessionData");
        var value = localStorage.getItem("session");
        span.innerHTML = value || "false";
      }

      window.addEventListener("load", function() {
        refreshSession()
      })

      window.addEventListener("message", function(event) {
        console.log('- Stadium received message -')
        console.log('Event: ', event)
        console.log('Action: ', event.data)

        switch (event.data) {
          case 'login':
            localStorage.setItem('session', true);
            break;
          case 'logout':
            localStorage.removeItem('session');
            break;
          case 'read':
            break;
          default:
            console.error('INVALID ACTION - ', event.data)
        }

        refreshData(event);
      });

      window.addEventListener("storage", function(event) {
        console.log('- Local storage changed -')
        console.log('Event: ', event)
        refreshSession()
      })
    </script>
  </body>
</html>
