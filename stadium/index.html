<!DOCTYPE html>
<html>
  <head>
    <title>SSO</title>
  </head>
  <body>
    <h1>Welcome to Stadium!</h1>
    <script type="text/javascript">
      document.cookie = "authenticated=true";
      localStorage.setItem('authenticated', true)

      // function sendSessionInfo() {
      //   console.log('- Send session info -')
      //   var session = localStorage.getItem('session');
      //   window.top.postMessage(session, '*');
      // }

      // window.addEventListener('load', function() {
      //   console.log('- Stadium loaded -');
      //   // This message is not sent as the parent hasn't loaded yet.
      //   sendSessionInfo()
      // })

      function refreshData(event) {
        var data = {
          cookie: document.cookie != "",
          session: localStorage.getItem('session'),
          localStorage: localStorage.getItem('authenticated')
        }
        event.source.postMessage(data, event.origin)
      }

      window.addEventListener("message", function(event) {
        console.log('- Stadium received message -')
        console.log('Event: ', event)
        console.log('Action: ', event.data)

        switch (event.data) {
          case 'login':
            localStorage.setItem('session', true);
            break;
          case 'logout':
            localStorage.removeItem('session');
            break;
          case 'read':
            break;
          default:
            console.error('INVALID ACTION - ', event.data)
        }

        refreshData(event);
      });
    </script>
  </body>
</html>
